<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Copy Function Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        .copy-btn {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
        }
        .copy-btn.copied {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        .test-text {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 600;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>üß™ Copy to Clipboard Test</h2>
        <p>This tests the improved copy functionality without CSP violations.</p>
        
        <div class="test-text">
            <strong>Test Message:</strong><br>
            Hi Paige, I'm Venkat, an ML Engineer with 4+ years of experience in deep learning and computer vision. Modernizing Medicine's work in healthcare tech is fascinating, and I'd love to connect and learn more about your talent acquisition strategies in this space.
        </div>
        
        <button class="copy-btn" id="testCopyBtn">üìã Copy Test Message</button>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <h3>Test Results:</h3>
        <ul id="testResults">
            <li>‚úÖ No inline event handlers (CSP compliant)</li>
            <li>‚úÖ Proper event listeners attached</li>
            <li id="clipboardTest">‚è≥ Testing clipboard functionality...</li>
        </ul>
    </div>

    <script>
        // Copy to clipboard function (same as in popup.js)
        async function copyToClipboard(text, buttonElement) {
            try {
                // Try modern clipboard API first
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                } else {
                    // Fallback for older browsers or non-secure contexts
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (!successful) {
                        throw new Error('Copy command failed');
                    }
                }
                
                // Visual feedback on button
                if (buttonElement) {
                    const originalText = buttonElement.textContent;
                    buttonElement.classList.add('copied');
                    buttonElement.textContent = 'üìã Copied!';
                    
                    setTimeout(() => {
                        buttonElement.classList.remove('copied');
                        buttonElement.textContent = originalText;
                    }, 2000);
                }
                
                showStatus('success', 'Copied to clipboard successfully!');
                document.getElementById('clipboardTest').innerHTML = '‚úÖ Clipboard functionality working';
                
            } catch (error) {
                console.error('Failed to copy to clipboard:', error);
                showStatus('error', 'Failed to copy to clipboard. Please select and copy manually.');
                document.getElementById('clipboardTest').innerHTML = '‚ùå Clipboard functionality failed: ' + error.message;
            }
        }

        function showStatus(type, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // Test setup
        document.addEventListener('DOMContentLoaded', () => {
            const testMessage = "Hi Paige, I'm Venkat, an ML Engineer with 4+ years of experience in deep learning and computer vision. Modernizing Medicine's work in healthcare tech is fascinating, and I'd love to connect and learn more about your talent acquisition strategies in this space.";
            
            const copyBtn = document.getElementById('testCopyBtn');
            copyBtn.addEventListener('click', () => {
                copyToClipboard(testMessage, copyBtn);
            });
            
            // Update test results
            setTimeout(() => {
                document.getElementById('clipboardTest').innerHTML = '‚úÖ Ready to test clipboard functionality';
            }, 500);
        });
    </script>
</body>
</html>